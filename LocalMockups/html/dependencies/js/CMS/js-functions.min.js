define(["jquery", "jquery-ui", "jquery.mmenu", "owl-carousel", "velocity", "jquery-menu-aim"], function(a) {
//Vars
var mobDrpHeight;
var theIndex;
var choText;
var theSrcs;
var viewportWidth;
var viewportHeight;
var mobHeadCont;
var mobHeadHeight;
var mobDropdown;
var newHeight;
var textLength;
var mobTopHeight;
var mobOvrHeight;
var totalMobHeight;
var ovrDropMenHeight;
var theDoc = $(document);
var shopBtn = $('li.drpLef');
var searchBtn = $('li.isSearch');
var dropContain = $('.drpDown-cont.deskMen');
var winScroll = theDoc.scrollTop();
var childLink = $('.mobSubMen').children('li').children('a');
var clickedChildLink = $('.mobSubMen').children('li.isClicked').children('a');
var grChildLink = $('.mobSubMen li ul li a');
var viewWidth = $(window).width();

//Functions

//NAV
// mobile menu calculate correct height
function mobScrollControl() {
  mobHeadHeight = $('.mobHeader .row').height();
  mobDropdown = $('.mobMen .drpDown');
  viewportHeight = $(window).height();
  mobDropdown.height(viewportHeight - mobHeadHeight);
}

function childMobScrollControl() {
  //calculating correct height for scroll of submenu
  mobHeadHeight = $('.mobHeader .row').height();
  mobDropdown = $('.mobMen .drpDown');
  mobSubDropdown = $('.mobSubMen');
  viewportHeight = $(window).height();
  newHeight = viewportHeight - mobHeadHeight;
  //set container height
  mobDropdown.height(newHeight);
  //set submenu height and subtract top margin 
  mobSubDropdown.height(newHeight - 50);
}

// mobile hamburger control
function burgerControl() {
  if ($('.mobMenBtn').hasClass("fa-bars")) {
    $('.mobMenBtn').removeClass("fa-bars").addClass("fa-close");
    $('.drpDown-cont.mobMen .drpDown-act').slideDown("medium");
    $('.mobMen').slideDown();
    if (!$('html, body').hasClass('noScroll')) {
      $('html, body').addClass('noScroll');
    }
  } else if ($('.mobMenBtn').hasClass("fa-close")) {
    $('.mobMenBtn').removeClass("fa-close").addClass("fa-bars");
    $('.drpDown.condense').css('overflow-y', 'scroll');
    $('.mobMen').fadeOut('fast');
    $('.drpDown').removeClass('noScroll');
    $('.mobMen .drpDown').find('li').removeClass('clicked');
    setTimeout(function () {
      $('.mobMen .drpDown, a.topLink').removeClass('condense');
    }, 500);
    if (!$('.mob-filt-ovrWrap').hasClass('opened')) {
      $('html, body').removeClass('noScroll');
    } else {
      $('html, body').addClass('noScroll');
    }
  }
}

//basically jsut the if close block in burgercontrol 
function destroyMobMen() {
  $('.mobMenBtn').removeClass("fa-close").addClass("fa-bars");
  $('.drpDown.condense').css('overflow-y', 'scroll');
  $('.mobMen').fadeOut('fast');
  $('.drpDown').removeClass('noScroll');
  $('.mobMen .drpDown').find('li').removeClass('clicked');
  setTimeout(function () {
    $('.mobMen .drpDown, a.topLink').removeClass('condense');
  }, 500);
  if (!$('.mob-filt-ovrWrap').hasClass('opened')) {
    $('html, body').removeClass('noScroll');
  } else {
    $('html, body').addClass('noScroll');
  }
}

//reveal search  on desk and mobile
function dropSearch() {
  destroyDeskDrp();
  if ($('.deskSearch .searchBarWrap').hasClass('open')) {
    $('.deskSearch .searchBarWrap').removeClass('open').fadeOut();
    $('.deskSearch .searchResultWrap').fadeOut();
  } else {
    $(this).toggleClass("clicked");
    shopBtn.removeClass("clicked");
    setTimeout(function () {
      $('.subMenWrap').css("display", "none");
    }, 400);
    $('.deskSearch .searchBarWrap').toggleClass("open").slideToggle("fast");
    setTimeout(function () {
      $('.deskSearch .searchResultWrap').fadeIn();
    }, 20);
  }
}

function dropSearchMob() {
  if ($('.mobSearch .searchBarWrap').hasClass('open')) {
    $('.mobSearch .searchBarWrap').removeClass('open').fadeOut();
    $('.mobSearch .searchResultWrap').fadeOut();
  } else {
    $(this).toggleClass("clicked");
    shopBtn.removeClass("clicked");
    setTimeout(function () {
      $('.subMenWrap').css("display", "none");
    }, 400);
    $('.mobSearch .searchBarWrap').toggleClass("open").slideToggle("fast");
    setTimeout(function () {
      $('.mobSearch .searchResultWrap').fadeIn();
    }, 20);
  }
}

function destroySearch() {
  $('.mobSearch .searchBarWrap').removeClass('open').fadeOut();
  $('.mobSearch .searchResultWrap').fadeOut();
}
function destroyDeskDrp() {
  $('.gChildMen').find('ul').hide();
  $('.drpDown li').removeClass('clicked');
  $('.childContWrap').find('.childCont').find('ul').hide();
   $('.childMenWrap').removeClass('open');
}

function searchScrollControl() {
  var mobHeight = $('.mobHeader').height();
  var seaHeight = 96;
  var totalHeight = mobHeight + seaHeight;
  var viewportHeight = $(window).height();
  var calcHeight = (viewportHeight - totalHeight);
  var mobSearWrap = $('.mobSearch .searchResultWrap');
  mobSearWrap.css('height', calcHeight + 'px')
}

//Kill team dropdowns
function killTeams() {
  $('.team-btn').removeClass("clicked");
  $('.teamDrp-theTeams ul').slideUp('fast');
}
// center btn on cat pages
function btnCenter() {
  killTeams();
  setTimeout(function () {
    var btnContHeight = $('.teamDrp-cont').outerHeight();
    var btnContPad = parseInt($('.teamDrp-cont').css('padding').replace(/[^-\d\.]/g, ''));
    var btnHeight = $('.buttonWrapCont').outerHeight();
    var calcPad = ((btnContHeight - btnHeight) / 2) - btnContPad;
    $('.buttonWrapCont').css('margin-top', calcPad + 'px');
  }, 200);
};

//cat page Related
function catPagefunc() {
  // bntCenter
  var viewWidth = $(window).width();
  if (viewWidth > 1103) {
    btnCenter();
    $(window, document).resize(function () {
      btnCenter();
    });
  } else {
  }
  $(window).resize(function () {
    var viewWidth = $(window).width();
    if (viewWidth > 1103) {
      btnCenter();
    } else {
    }
  });
}

function featProdSlice() {
  //top ath slider 
  //data templating 
  //desktop and mob output el
  var outPut = $('.topAthOut');
  var outPutMob = $('.slide-cont.theSlider');
  //desk and mobile template elements
  var templateDesk = $('#topAthTemp').html();
  var templateMob = $('#topAthTempMob').html();
  //handlebar template compilation
  var CompiledTemplate = Handlebars.compile(templateDesk);
  var CompiledTemplateMob = Handlebars.compile(templateMob);
  //the data
  var data = {
    "images": [
      {
        "imgSrc": "https://placebear.com/g/500/600",
        "imgTitle": "Goes to codepen goog",
        "linkSrc": "http://www.codepen.io",
        "alt": "Codepen"
      },
      {
        "imgSrc": "https://placebear.com/g/500/600",
        "imgTitle": "Goes to google goog",
        "linkSrc": "http://www.google.com",
        "alt": "Google"
      },
      {
        "imgSrc": "https://placebear.com/g/500/600",
        "imgTitle": "Goes to jsfiddle",
        "linkSrc": "http://www.jsfiddle.com",
        "alt": "JSFiddle"
      }
    ]
  };
  //pass data to templates
  var outContent = CompiledTemplate(data);
  var outContentMob = CompiledTemplateMob(data);
  //output
  $(outPut).html(outContent);
  $(outPutMob).html(outContentMob);
  //init top slider AFTER templating, or top ath 
  $('.theSlider').slick({
    dots: true,
    arrows: false
  });
}

//Copy teams from desktop to mobile
function teamOnMob() {
  var teamsActual = $('.teamDrp-theTeams ul').html();
  $('.mob-filt-drpDowns .drpDownOptions.team').html(teamsActual);
}
//Clean nested child classes
function cleanChildren() {
  childLink.parent('li').removeClass('isClicked');
  childLink.parent('li').removeClass('offChild');
  childLink.parent('li').removeClass('onChild');
}

//Color swatches 
function getColors(el) {
  var theImgLogo = $(el);
  var theImgSrc = theImgLogo.attr('src');
  var img = document.createElement('img');
  img.setAttribute('src', theImgSrc)
  function imgSwatches() {
    var vibrant = new Vibrant(img);
    var swatches = vibrant.swatches();
    return swatches
  }
  return imgSwatches()
}

function logoColorTeamPage() {
  //get colors from vibrant
  var topImgSwatches = getColors('#teamLogo');
  var vibrantHex = topImgSwatches.Vibrant.getHex();
  var mutedHex = topImgSwatches.Muted.getHex();
  var darkVibrantHex = topImgSwatches.DarkVibrant.getHex();
  var darkMutedHex = topImgSwatches.DarkMuted.getHex();
  var lightVibrantHex = topImgSwatches.LightVibrant.getHex();
  var dVRGB = topImgSwatches.DarkVibrant.getRgb();
  //color elements
  $('.headCrumbs a').css('background', vibrantHex);
  $('.headCrumbs a').css('color', darkVibrantHex);
  $('.singleTeam .teamDrp-act-right h1').css('color', darkVibrantHex);
}

function calcChildHeights() {
  var childContHeight = $('.childContWrap').height();
  var gChildContHeight = $('.gChildContWrap').height();
  console.log(childContHeight);
  console.log(gChildContHeight);
  if (childContHeight > gChildContHeight) {
    $('.childContWrap').find('ul.open').css('height', childContHeight + 'px');
    $('.gChildContWrap').find('ul.open').css('height', childContHeight + 'px');
  }
  else if (childContHeight < gChildContHeight) {
    $('.childContWrap').find('ul.open').css('height', gChildContHeight + 'px');
    $('.gChildContWrap').find('ul.open').css('height', gChildContHeight + 'px');
  }
}

function stickHead() {
  $(window).scroll(function () {
    var scroll = $(window).scrollTop();
    if (scroll >= 183) {
      $("body").addClass("hasFix");
      $(".headA").addClass("fixHead");
    } else {
      $("body").removeClass("hasFix");
      $(".headA").removeClass("fixHead");
    }
  });
}

//Vert and Horiz auto center
jQuery.fn.horCenter = function () {
  var theWidth = $(this).outerWidth();
  var calcWidth = (theWidth / 2) + 'px';
  $(this).css('position', 'absolute');
  $(this).css('left', '50%');
  $(this).css('margin-left', '-' + calcWidth);
}
jQuery.fn.verCenter = function () {
  var theHeight = $(this).outerHeight();
  var calcHeight = (theHeight / 2) + 'px';
  $(this).css('position', 'absolute');
  $(this).css('top', '50%');
  $(this).css('margin-top', '-' + calcHeight);
}
jQuery.fn.bothCenter = function () {
  var theHeight = $(this).outerHeight();
  var calcHeight = (theHeight / 2) + 'px';
  var theWidth = $(this).outerWidth();
  var calcWidth = (theWidth / 2) + 'px';
  $(this).css('position', 'absolute');
  $(this).css('top', '50%');
  $(this).css('margin-top', '-' + calcHeight);
  $(this).css('left', '50%');
  $(this).css('margin-left', '-' + calcWidth);
}

/*

Global JS on document ready

*/
$(document).ready(function () {
  //Desktop nav
  //Parent menu item
  $('.deskMen .drpDown li').click(function () {
    if ($(this).hasClass('clicked')) {
      $('.childMenWrap').removeClass('open');
    }
    else {
      $('.childMenWrap').addClass('open');
    }
  });
  $('.deskMen .drpDown li').click(function () {
    if ($(this).hasClass('clicked')) {
      $('.gChildMen').find('ul').slideUp();
      $('.drpDown li').removeClass('clicked');
      $('.childContWrap').find('.childCont').find('ul').slideUp();
    }
    else {
      $('.deskMen .drpDown li').removeClass('clicked');
      $(this).addClass('clicked');
      //parent index
      var topIndex = $(this).index() + 1;
      var childCont = $('.childContWrap').find('.childCont:nth-of-type(' + topIndex + ')');
      //slide up control menus
      $('.childContWrap').find('.childCont').find('ul').hide();
      $('.childContWrap').find('.childCont').find('ul').removeClass('open');
      childCont.find('ul').addClass('open');
      childCont.find('ul').slideDown();
      var firstChild = childCont.find('ul').find('li:first-child');
      firstChild.trigger('click');
      setTimeout(function () {
        calcChildHeights();
      }, 600);
    }
  });
  //child Menu Item
  $('.childCont ul li').click(function () {
    $('.childCont ul li').removeClass('clicked');
    $(this).addClass('clicked');
    var thisIndex = $(this).index() + 1;
    var parIndex = $(this).parent('ul').parent('div').index() + 1;
    var gChildCont = $('.gChildContWrap').find('.gChildCont:nth-of-type(' + parIndex + ')');
    var gChildMen = gChildCont.find('.gChildMen:nth-of-type(' + thisIndex + ')');
    $('.gChildMen').find('ul').hide();
    $('.gChildMen').find('ul').removeClass('open');
    gChildMen.find('ul').addClass('open');
    gChildMen.find('ul').slideDown();
    setTimeout(function () {
      calcChildHeights();
    }, 600);
  });
  //Search Related
  searchBtn.click(function () {
    destroyMobMen();
    destroyDeskDrp();
    dropSearch();
  });
  $('i.mobSearch').click(function () {
    if ($('.mobMenBtn').hasClass("fa-bars")) {
      searchScrollControl();
      dropSearchMob();
    } else {
      destroyMobMen();
      setTimeout(function () {
        searchScrollControl();
        dropSearchMob();
      }, 220);
    }
  });
  $('.searchBarWrap').click(function () {
    return false;
  });
  $('.searchBarWrap .fa-close').click(function () {
    $('.searchBarWrap').removeClass('open').fadeOut();
    $('.searchResultWrap').fadeOut();
  })

  //sticky header
  // stickHead();

  //mob men btn
  $('.mobMenBtn').click(function () {
    destroySearch();
    burgerControl();
    mobScrollControl();
  });
  $('.drpDown li a.topLink').click(function () {
    //condensing menu and killing scroll of outer menu
    $(this).parent('li').parent('ul').toggleClass("condense");
    $('a.topLink').toggleClass("condense");
    $('.mobMen .drpDown').find('li').removeClass('clicked');
    $(this).parent('li').toggleClass('clicked');
    $(this).toggleClass('clicked');
    $('.drpDown').toggleClass('noScroll');
    $('li').removeClass('onChild');
    $('li').removeClass('offChild');
    $('li').removeClass('isClicked');
    $(this).removeClass('primeChild');
    $(this).removeClass('notPrime');
    childMobScrollControl();
    $(this).find()
  });
  childLink.click(function () {
    if ($(this).parent('li').hasClass('isClicked')) {
      $(this).addClass('notPrime');
      $(this).removeClass('primeChild');
      cleanChildren();
      return false;
    } else {
      $(this).parent('li').addClass('isClicked');
      childLink.parent('li').addClass('offChild');
      childLink.parent('li').removeClass('onChild');
      $(this).addClass('primeChild');
      $(this).removeClass('notPrime');
      $(this).parent('li').addClass('onChild');
      return false;
    }
  });


  $('.drpDown li').click(function () {
    var subMenWrap = $('.subMen').height();
    setTimeout(function () {
      $('.subMenCont').css('height', subMenWrap + 'px');
    }, 500);
  });
  //Catalog functions
  //filt stuff
  $('.filt-mid ul li').click(function () {
    $('.filt-mid ul li').removeClass("clicked");
    $(this).addClass("clicked");
  });
  //filt sort menu
  $('.sortMen-cont').children('a').click(function () {
    $('.sortMen-cont').find('ul').slideToggle('fast');
  });
  //slide menu after selecting option
  $('.sortMen-cont ul li').click(function () {
    $('.sortMen-cont').find('ul').slideToggle('fast');
  });
  //change text
  $('.sortMen-cont').find('ul').find('li').click(function () {
    $('.sortMen-cont').find('ul').find('li').removeClass("chosen");
    $(this).addClass("chosen");
    choText = $('li.chosen').text();
    $('.sortMen-cont a span').text(choText);
  });
  //prod filt dropdowns
  $('.filt-mid ul li').click(function () {
    theIndex = $(this).index() + 2;
    $('.filt-drp').fadeOut('fast');
    $('.filt-drp:nth-of-type(' + theIndex + ')').slideToggle();
  });
  //mob filt 
  $('.mob-filt-drpDowns .drpDownMen li').click(function () {
    theIndex = $(this).index() + 2;
    $('.mob-filt-drpDowns .drpDownMen li').removeClass('clicked');
    $(this).addClass("clicked");
    $('ul.drpDownOptions').slideUp();
    $('ul.drpDownOptions:nth-of-type(' + theIndex + ')').slideDown();
    return false;
  });
  //mob filt btns 
  $('.mob-btnOne').click(function (e) {
    //fade in overlay
    $('.mob-filt-ovrWrap').fadeIn();
    $('.mob-filt-ovrWrap').addClass("opened");
    //calculate proper height for scroll
    viewportHeight = $(window).height();
    mobTopHeight = $('.mob-filt-head-wrap').height();
    mobOvrHeight = $('.mobHeader').height();
    ovrDropMenHeight = $('.drpDownMen').height();
    totalMobHeight = mobTopHeight + mobOvrHeight;
    //subtract
    mobDrpHeight = viewportHeight - (totalMobHeight + ovrDropMenHeight);
    $('.drpDownOptions').css('max-height', function () {
      return mobDrpHeight + "px";
    });
    $('html').addClass("noScroll");
    e.preventDefault();
  });
  $('.closeBtn').click(function (e) {
    $('html, body').removeClass("noScroll");
    $('.mob-filt-ovrWrap').fadeOut();
    $('.mob-team-ovrWrap').fadeOut();
    $('.mob-filt-ovrWrap').removeClass("opened");
    e.preventDefault();
  });
  //catalog prod add to cart on hvr
  $('ul.products li').hover(function () {
    $(this).children('a').toggleClass("hovered");
  });
  //catalog size correction
  $('span.theTitle').each(function () {
    textLength = $(this).text().length;
    if (textLength > 35) {
      $(this).css('font-size', '.8em');
    }
    else {
      $(this).css('font-size', '1em');
    }
  });
  //checkboxes
  $('input[type="checkbox"]').customCheckbox();
});
});